ANDROID_APPLICATION_NAME = InputService
ANDROID_PACKAGE_NAME = NBP_B2G_$(ANDROID_APPLICATION_NAME)
ANDROID_PACKAGE_PATH = org.nbp.b2g.input

ANDROID_JNI_DIRECTORY = jni
ANDROID_JNI_SOURCES = \
   $(ANDROID_JNI_DIRECTORY)/utils.h \
   $(ANDROID_JNI_DIRECTORY)/utils.c \
   $(ANDROID_JNI_DIRECTORY)/uinput.c \
   $(ANDROID_JNI_DIRECTORY)/kbddev.c \
   $(ANDROID_JNI_DIRECTORY)/kbdmon.c \
   $(ANDROID_JNI_DIRECTORY)/metec_flat20_ioctl.h \
   $(ANDROID_JNI_DIRECTORY)/braille.c \
   $(ANDROID_JNI_DIRECTORY)/Android.mk

ANDROID_ASSETS_DIRECTORY = assets
ANDROID_BINARIES_DIRECTORY = bin
ANDROID_LIBRARIES_DIRECTORY = libs

ANDROID_PLATFORM_NAME = armeabi
ANDROID_PLATFORM_DIRECTORY = $(ANDROID_LIBRARIES_DIRECTORY)/$(ANDROID_PLATFORM_NAME)

ANDROID_PACKAGE_FILE = $(ANDROID_BINARIES_DIRECTORY)/$(ANDROID_PACKAGE_NAME)-debug.apk
ANDROID_NATIVE_LIBRARY = $(ANDROID_PLATFORM_DIRECTORY)/lib$(ANDROID_APPLICATION_NAME).so
ANDROID_LOCAL_FILES = local.properties

all: apk
apk: $(ANDROID_PACKAGE_FILE)
jni: $(ANDROID_NATIVE_LIBRARY)

$(ANDROID_PACKAGE_FILE): jni AndroidManifest.xml $(ANDROID_LOCAL_FILES)
	ant debug

$(ANDROID_NATIVE_LIBRARY): $(ANDROID_JNI_SOURCES)
	ndk-build

$(ANDROID_LOCAL_FILES): FORCE
	android update project --path .

FORCE:

clean::
	-rm -f $(ANDROID_LOCAL_FILES)
	-rm -f -r $(ANDROID_BINARIES_DIRECTORY)
	-rm -f -r $(ANDROID_LIBRARIES_DIRECTORY)
	-rm -f -r gen

install: all
	adb install $(ANDROID_PACKAGE_FILE)

reinstall: all
	adb install -r $(ANDROID_PACKAGE_FILE)

uninstall:
	adb uninstall $(ANDROID_PACKAGE_PATH)

